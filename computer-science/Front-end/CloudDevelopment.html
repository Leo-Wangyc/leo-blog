<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Leo&#39;s Starship</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/leo-blog/assets/css/0.styles.6ec2a987.css" as="style"><link rel="preload" href="/leo-blog/assets/js/app.bfe0a0b7.js" as="script"><link rel="preload" href="/leo-blog/assets/js/2.36229468.js" as="script"><link rel="preload" href="/leo-blog/assets/js/4.b471a861.js" as="script"><link rel="prefetch" href="/leo-blog/assets/js/10.d3ccb201.js"><link rel="prefetch" href="/leo-blog/assets/js/11.34ea13c9.js"><link rel="prefetch" href="/leo-blog/assets/js/12.100bdd4c.js"><link rel="prefetch" href="/leo-blog/assets/js/13.0196917d.js"><link rel="prefetch" href="/leo-blog/assets/js/14.e0de9719.js"><link rel="prefetch" href="/leo-blog/assets/js/15.bbbbc91e.js"><link rel="prefetch" href="/leo-blog/assets/js/16.894b3e9b.js"><link rel="prefetch" href="/leo-blog/assets/js/17.66638d45.js"><link rel="prefetch" href="/leo-blog/assets/js/18.519870b3.js"><link rel="prefetch" href="/leo-blog/assets/js/19.557679db.js"><link rel="prefetch" href="/leo-blog/assets/js/20.fce0f6ce.js"><link rel="prefetch" href="/leo-blog/assets/js/21.ce536719.js"><link rel="prefetch" href="/leo-blog/assets/js/22.c16cfa9f.js"><link rel="prefetch" href="/leo-blog/assets/js/23.666f621b.js"><link rel="prefetch" href="/leo-blog/assets/js/24.be802471.js"><link rel="prefetch" href="/leo-blog/assets/js/25.595306b9.js"><link rel="prefetch" href="/leo-blog/assets/js/26.195f319f.js"><link rel="prefetch" href="/leo-blog/assets/js/27.2a5318e4.js"><link rel="prefetch" href="/leo-blog/assets/js/28.8b21ba99.js"><link rel="prefetch" href="/leo-blog/assets/js/29.d4abc438.js"><link rel="prefetch" href="/leo-blog/assets/js/3.1ae439f9.js"><link rel="prefetch" href="/leo-blog/assets/js/30.35cd2f3c.js"><link rel="prefetch" href="/leo-blog/assets/js/31.472ee938.js"><link rel="prefetch" href="/leo-blog/assets/js/32.336b1f6a.js"><link rel="prefetch" href="/leo-blog/assets/js/5.0770b70b.js"><link rel="prefetch" href="/leo-blog/assets/js/6.917bb234.js"><link rel="prefetch" href="/leo-blog/assets/js/7.3c7496cf.js"><link rel="prefetch" href="/leo-blog/assets/js/8.415d7f3c.js"><link rel="prefetch" href="/leo-blog/assets/js/9.5080fa6c.js">
    <link rel="stylesheet" href="/leo-blog/assets/css/0.styles.6ec2a987.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/leo-blog/" class="home-link router-link-active"><!----> <span class="site-name">Leo's Starship</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/leo-blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leo-blog/" class="nav-link">
  Home
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/leo-blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leo-blog/" class="nav-link">
  Home
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Computer Science</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>C</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Front End</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/leo-blog/computer-science/Front-end/FrontEndTheory.html" class="sidebar-link">Front-End Theory</a></li><li><a href="/leo-blog/computer-science/Front-end/HTML5.html" class="sidebar-link">HTML</a></li><li><a href="/leo-blog/computer-science/Front-end/CSS.html" class="sidebar-link">CSS</a></li><li><a href="/leo-blog/computer-science/Front-end/JS&amp;ES6+.html" class="sidebar-link">JS &amp; ES6+</a></li><li><a href="/leo-blog/computer-science/Front-end/TypeScript.html" class="sidebar-link">TypeScript</a></li><li><a href="/leo-blog/computer-science/Front-end/Node.html" class="sidebar-link">Node</a></li><li><a href="/leo-blog/computer-science/Front-end/Vue.html" class="sidebar-link">Vue</a></li><li><a href="/leo-blog/computer-science/Front-end/React.html" class="sidebar-link">React</a></li><li><a href="/leo-blog/computer-science/Front-end/Miniapp.html" class="sidebar-link">Mini App</a></li><li><a href="/leo-blog/computer-science/Front-end/Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/leo-blog/computer-science/Front-end/ComponentDesign.html" class="sidebar-link">Component Design</a></li><li><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html" aria-current="page" class="active sidebar-link">Cloud Development</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html#云函数本地调试方法" class="sidebar-link">云函数本地调试方法</a></li><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html#云函数调用云数据库方式" class="sidebar-link">云函数调用云数据库方式</a></li><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html#云函数引入插件" class="sidebar-link">云函数引入插件</a></li><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html#云函数中的时区问题" class="sidebar-link">云函数中的时区问题</a></li><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html#云数据库数据获取-get" class="sidebar-link">云数据库数据获取 get</a></li><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html#恋之农场项目" class="sidebar-link">恋之农场项目</a></li><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html#开发中遇到的问题" class="sidebar-link">开发中遇到的问题</a></li></ul></li><li><a href="/leo-blog/computer-science/Front-end/project.html" class="sidebar-link">Real Project</a></li><li><a href="/leo-blog/computer-science/Front-end/special.html" class="sidebar-link">Special</a></li></ul></section></li><li><a href="/leo-blog/computer-science/algorithm.html" class="sidebar-link">Algorithm</a></li><li><a href="/leo-blog/computer-science/ComputerScience.html" class="sidebar-link">Computer Tech</a></li><li><a href="/leo-blog/computer-science/Git.html" class="sidebar-link">Git</a></li><li><a href="/leo-blog/computer-science/vue-press.html" class="sidebar-link">Vue Press</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>English</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ecnomics</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>CloudDevelopment</p> <p>周分享会（2021-8-20）</p> <ul><li>主题：小程序云开发</li> <li>ppt 地址：https://prezi.com/view/LuFhZsaxvjLS7vaeV1eR/</li> <li>相关参考视频/文档：
① 快速搭建 Taro 云开发项目脚手架：https://taro-docs.jd.com/taro/docs/GETTING-STARTED
② 云开发学习视频：https://www.bilibili.com/video/BV1x54y1s7pk?p=60&amp;spm_id_from=pageDriver
③ 云函数部署失败解决办法：https://blog.csdn.net/qq_34464926/article/details/96497906
④ 微信云开发文档：https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html
⑤ Taro 云开发文档：https://taro-docs.jd.com/taro/docs/apis/cloud/cloud/</li></ul> <h1 id="前置知识"><a href="#前置知识" class="header-anchor">#</a> 前置知识</h1> <p>###微信 openId 和微信 unionId</p> <blockquote><p>https://juejin.cn/post/6844903789044973575</p></blockquote> <h1 id="云开发"><a href="#云开发" class="header-anchor">#</a> 云开发</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <h1 id="云函数"><a href="#云函数" class="header-anchor">#</a> 云函数</h1> <h2 id="云函数本地调试方法"><a href="#云函数本地调试方法" class="header-anchor">#</a> 云函数本地调试方法</h2> <p>前置条件：<strong>要保证在有云函数的项目中进行本地调试，否则会报找不到云函数</strong></p> <img src="/leo-blog/assets/img/image-20211223175455216.74677879.png" alt="image-20211223175455216" style="zoom:50%;"> <p>即如图所示，需为上述项目中才可</p> <p>具体步骤：</p> <p>1.<img src="/leo-blog/assets/img/image-20211223175558501.50467878.png" alt="image-20211223175558501" style="zoom:50%;"></p> <p>打开云开发面板</p> <p>2.<img src="/leo-blog/assets/img/image-20211223175647209.2843d593.png" alt="image-20211223175647209" style="zoom:50%;"></p> <p>进入云函数区块</p> <p>3.<img src="/leo-blog/assets/img/image-20211223175716100.1497578b.png" alt="image-20211223175716100" style="zoom:40%;"></p> <p>选择本地调试</p> <p>4.<img src="/leo-blog/assets/img/image-20211223175825223.09cc4630.png" alt="image-20211223175825223" style="zoom:50%;"></p> <p>开发面板右侧，选择手动调用，如果选择从模拟器调用，请保持基础库等级低于 2.14.3</p> <p>5.<img src="/leo-blog/assets/img/image-20211223180127768.4927e5d8.png" alt="image-20211223180127768" style="zoom:50%;"></p> <p>更改上述相关参数，即可实现本地调用</p> <h2 id="云函数调用云数据库方式"><a href="#云函数调用云数据库方式" class="header-anchor">#</a> 云函数调用云数据库方式</h2> <blockquote><p>云函数请求云数据库为异步，所以，需要进行异步处理</p> <p>https://blog.csdn.net/weixin_43430789/article/details/90601066</p></blockquote> <ul><li><p><strong>云函数调用云数据库后，直接返回 success，没有返回所 return 的内容，或者打印出来是 Undefined</strong></p> <ol><li>先查看云数据库集合名称是否正确</li> <li>再查看云数据库权限是否设置为可读</li> <li>仔细查看异步逻辑，promise 之间的处理</li></ol> <p>详细样例可以查看农场项目里面的 getGoldAndCheck 云函数</p></li></ul> <h2 id="云函数引入插件"><a href="#云函数引入插件" class="header-anchor">#</a> 云函数引入插件</h2> <h2 id="云函数中的时区问题"><a href="#云函数中的时区问题" class="header-anchor">#</a> 云函数中的时区问题</h2> <p>注：云函数中默认的时区为 UTC+0，并不是 UTC+8 的中国时区，如果要默认 UTC+8，则需要更改云函数的环境变量，设置 TZ 为 asia/shanghai</p> <blockquote><p>https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/functions/notice.html</p></blockquote> <p>具体操作：</p> <ul><li><p>第一步，进入云函数版本管理</p> <img src="/leo-blog/assets/img/image-20220105171511971.79aee28c.png" alt="image-20220105171511971" style="zoom:30%;"></li> <li><p>第二步，点击配置</p> <img src="/leo-blog/assets/img/image-20220105171604319.3b722545.png" alt="image-20220105171604319" style="zoom:30%;"></li> <li><p>第三步，写入配置 TZ, Asia/Shanghai，点击确认即可</p> <img src="/leo-blog/assets/img/image-20220105171718485.b15ee42a.png" alt="image-20220105171718485" style="zoom:50%;"></li></ul> <h1 id="云数据库"><a href="#云数据库" class="header-anchor">#</a> 云数据库</h1> <h2 id="云数据库数据获取-get"><a href="#云数据库数据获取-get" class="header-anchor">#</a> 云数据库数据获取 get</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> db <span class="token operator">=</span> Taro<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//或者 wx.cloud.database();</span>
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// collection表示集合，传参为集合的名称</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h1 id="云存储"><a href="#云存储" class="header-anchor">#</a> 云存储</h1> <h1 id="项目实战"><a href="#项目实战" class="header-anchor">#</a> 项目实战</h1> <h2 id="恋之农场项目"><a href="#恋之农场项目" class="header-anchor">#</a> 恋之农场项目</h2> <h2 id="开发中遇到的问题"><a href="#开发中遇到的问题" class="header-anchor">#</a> 开发中遇到的问题</h2> <h3 id="_1-如何让多渠道小程序共用一套云"><a href="#_1-如何让多渠道小程序共用一套云" class="header-anchor">#</a> 1.如何让多渠道小程序共用一套云</h3> <blockquote><p>无法实现</p></blockquote> <h3 id="_2-如何同时打开同一个微信和-qq-小程序"><a href="#_2-如何同时打开同一个微信和-qq-小程序" class="header-anchor">#</a> 2. 如何同时打开同一个微信和 qq 小程序</h3> <p>Taro 的项目 config 目录下进行配置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">outputRoot</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dist/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARO_ENV</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
</code></pre></div><p>把输入端带上当前跑的环境即可互不影响</p> <h1 id="云部署静态网站"><a href="#云部署静态网站" class="header-anchor">#</a> 云部署静态网站</h1> <p>云部署静态网站可以用于从普通浏览器，或者别的腾讯系 app 中跳转小程序</p> <blockquote><p>参考文档：https://zhuanlan.zhihu.com/p/336173709</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/leo-blog/computer-science/Front-end/ComponentDesign.html" class="prev">
        Component Design
      </a></span> <span class="next"><a href="/leo-blog/computer-science/Front-end/project.html">
        Real Project
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/leo-blog/assets/js/app.bfe0a0b7.js" defer></script><script src="/leo-blog/assets/js/2.36229468.js" defer></script><script src="/leo-blog/assets/js/4.b471a861.js" defer></script>
  </body>
</html>
