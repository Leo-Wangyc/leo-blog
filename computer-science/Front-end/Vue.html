<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Leo&#39;s Starship</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/leo-blog/assets/css/0.styles.6ec2a987.css" as="style"><link rel="preload" href="/leo-blog/assets/js/app.bfe0a0b7.js" as="script"><link rel="preload" href="/leo-blog/assets/js/2.36229468.js" as="script"><link rel="preload" href="/leo-blog/assets/js/23.666f621b.js" as="script"><link rel="prefetch" href="/leo-blog/assets/js/10.d3ccb201.js"><link rel="prefetch" href="/leo-blog/assets/js/11.34ea13c9.js"><link rel="prefetch" href="/leo-blog/assets/js/12.100bdd4c.js"><link rel="prefetch" href="/leo-blog/assets/js/13.0196917d.js"><link rel="prefetch" href="/leo-blog/assets/js/14.e0de9719.js"><link rel="prefetch" href="/leo-blog/assets/js/15.bbbbc91e.js"><link rel="prefetch" href="/leo-blog/assets/js/16.894b3e9b.js"><link rel="prefetch" href="/leo-blog/assets/js/17.66638d45.js"><link rel="prefetch" href="/leo-blog/assets/js/18.519870b3.js"><link rel="prefetch" href="/leo-blog/assets/js/19.557679db.js"><link rel="prefetch" href="/leo-blog/assets/js/20.fce0f6ce.js"><link rel="prefetch" href="/leo-blog/assets/js/21.ce536719.js"><link rel="prefetch" href="/leo-blog/assets/js/22.c16cfa9f.js"><link rel="prefetch" href="/leo-blog/assets/js/24.be802471.js"><link rel="prefetch" href="/leo-blog/assets/js/25.595306b9.js"><link rel="prefetch" href="/leo-blog/assets/js/26.195f319f.js"><link rel="prefetch" href="/leo-blog/assets/js/27.2a5318e4.js"><link rel="prefetch" href="/leo-blog/assets/js/28.8b21ba99.js"><link rel="prefetch" href="/leo-blog/assets/js/29.d4abc438.js"><link rel="prefetch" href="/leo-blog/assets/js/3.1ae439f9.js"><link rel="prefetch" href="/leo-blog/assets/js/30.35cd2f3c.js"><link rel="prefetch" href="/leo-blog/assets/js/31.472ee938.js"><link rel="prefetch" href="/leo-blog/assets/js/32.336b1f6a.js"><link rel="prefetch" href="/leo-blog/assets/js/4.b471a861.js"><link rel="prefetch" href="/leo-blog/assets/js/5.0770b70b.js"><link rel="prefetch" href="/leo-blog/assets/js/6.917bb234.js"><link rel="prefetch" href="/leo-blog/assets/js/7.3c7496cf.js"><link rel="prefetch" href="/leo-blog/assets/js/8.415d7f3c.js"><link rel="prefetch" href="/leo-blog/assets/js/9.5080fa6c.js">
    <link rel="stylesheet" href="/leo-blog/assets/css/0.styles.6ec2a987.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/leo-blog/" class="home-link router-link-active"><!----> <span class="site-name">Leo's Starship</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/leo-blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leo-blog/" class="nav-link">
  Home
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/leo-blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/leo-blog/" class="nav-link">
  Home
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Computer Science</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>C</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Front End</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/leo-blog/computer-science/Front-end/FrontEndTheory.html" class="sidebar-link">Front-End Theory</a></li><li><a href="/leo-blog/computer-science/Front-end/HTML5.html" class="sidebar-link">HTML</a></li><li><a href="/leo-blog/computer-science/Front-end/CSS.html" class="sidebar-link">CSS</a></li><li><a href="/leo-blog/computer-science/Front-end/JS&amp;ES6+.html" class="sidebar-link">JS &amp; ES6+</a></li><li><a href="/leo-blog/computer-science/Front-end/TypeScript.html" class="sidebar-link">TypeScript</a></li><li><a href="/leo-blog/computer-science/Front-end/Node.html" class="sidebar-link">Node</a></li><li><a href="/leo-blog/computer-science/Front-end/Vue.html" aria-current="page" class="active sidebar-link">Vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/Vue.html#源码分析" class="sidebar-link">源码分析</a></li><li class="sidebar-sub-header"><a href="/leo-blog/computer-science/Front-end/Vue.html#diff-算法" class="sidebar-link">Diff 算法</a></li></ul></li><li><a href="/leo-blog/computer-science/Front-end/React.html" class="sidebar-link">React</a></li><li><a href="/leo-blog/computer-science/Front-end/Miniapp.html" class="sidebar-link">Mini App</a></li><li><a href="/leo-blog/computer-science/Front-end/Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/leo-blog/computer-science/Front-end/ComponentDesign.html" class="sidebar-link">Component Design</a></li><li><a href="/leo-blog/computer-science/Front-end/CloudDevelopment.html" class="sidebar-link">Cloud Development</a></li><li><a href="/leo-blog/computer-science/Front-end/project.html" class="sidebar-link">Real Project</a></li><li><a href="/leo-blog/computer-science/Front-end/special.html" class="sidebar-link">Special</a></li></ul></section></li><li><a href="/leo-blog/computer-science/algorithm.html" class="sidebar-link">Algorithm</a></li><li><a href="/leo-blog/computer-science/ComputerScience.html" class="sidebar-link">Computer Tech</a></li><li><a href="/leo-blog/computer-science/Git.html" class="sidebar-link">Git</a></li><li><a href="/leo-blog/computer-science/vue-press.html" class="sidebar-link">Vue Press</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>English</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ecnomics</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Vue</p> <h1 id="vue2"><a href="#vue2" class="header-anchor">#</a> Vue2</h1> <h1 id="vue3"><a href="#vue3" class="header-anchor">#</a> Vue3</h1> <h2 id="源码分析"><a href="#源码分析" class="header-anchor">#</a> 源码分析</h2> <h3 id="整体模块划分"><a href="#整体模块划分" class="header-anchor">#</a> 整体模块划分</h3> <p>整体模块划分为三大块，<strong>compiler-module，renderer-module，reactivity-module</strong></p> <ul><li>编译器模块 compiler 将视图模板编译成一个<strong>渲染函数</strong></li> <li>数据响应式模块 reactivity 将模板中使用到的数据对象变为为响应式对象</li> <li>渲染模块开始进入渲染阶段(render phase)，调用刚刚生成的<strong>渲染函数</strong>，观察响应式数据对象的变化，并返回一个<strong>虚拟的 DOM 节点</strong></li> <li>然后在挂载阶段(mount phase)，调用<code>mount</code>函数，使用<strong>虚拟 DOM 节点</strong>来创建 web 页面</li> <li>当观察的响应式对象发生变化时，渲染模块会再次调用<strong>渲染函数</strong>创建一个新的虚拟 DOM 节点，然后发送到<code>patch</code>函数中，进行 DOM diff，然后更新视图</li></ul> <p>####响应式原理分析</p> <p><strong>个人简单理解一下整理的流程</strong></p> <p><strong>详细内容</strong></p> <ol><li><p>reactive</p> <blockquote><p>http://www.zhufengpeixun.com/advance/guide/04.reactivity-2.html#reactivity%E6%A8%A1%E5%9D%97%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8</p> <p>密码：2558@手机号后四位</p></blockquote></li> <li><p>effect</p></li> <li><p>watch</p></li> <li><p>computed</p></li> <li><p>ref</p></li></ol> <h3 id="虚拟-dom"><a href="#虚拟-dom" class="header-anchor">#</a> 虚拟 DOM</h3> <h2 id="diff-算法"><a href="#diff-算法" class="header-anchor">#</a> Diff 算法</h2> <h3 id="vue3-diff-算法"><a href="#vue3-diff-算法" class="header-anchor">#</a> vue3 diff 算法</h3> <p>vue3 中比较子元素数组，使用到了 diff 算法，具体的流程如下：</p> <p>统一使用案例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">c1</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 之前的子元素</span>
<span class="token literal-property property">c2</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> e<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> h<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 新的子元素</span>
</code></pre></div><ol><li><p><strong>先从头开始比</strong></p> <p>按上面的例子，那么可以排除掉 ab 不需要重新渲染</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 第一轮筛选过后</span>
<span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> e<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> h<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span> <span class="token comment">// 之前的子元素 // 新的子元素</span>
  <span class="token comment">// 筛选结果，可以不需要重新渲染ab</span>
  <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> h<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 之前的子元素 // 新的子元素</span>
</code></pre></div></li> <li><p><strong>再从尾部开始比</strong></p> <p>继续筛选，可以筛掉 fg，根据下标，进行 unmount</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 第二轮筛选过后</span>
<span class="token punctuation">[</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> h<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span> <span class="token comment">// 之前的子元素 // 新的子元素</span>
  <span class="token comment">// 筛选结果，可以不需要重新渲染fg</span>
  <span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 之前的子元素 // 新的子元素</span>
</code></pre></div></li> <li><p><strong>然后判断是否为最简单的插入和删除操作</strong></p> <p>本情况，另起一个新例子，不看上面的，如下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 案例1 --------------------------</span>
<span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>
  <span class="token comment">// 第一二轮筛选完成后，发现老节点已经没了，剩下一个新节点d，直接进行插入d的操作即可</span>

  <span class="token comment">// 案例2 --------------------------</span>
  <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 第一二轮筛选完成后，发现新节点已经没了，剩下一个老节点d，直接进行删除d的操作即可</span>
</code></pre></div><p>上面两案例中，经过第一轮，第二轮的筛选过后，会存在一个情况，那就是新或老元素节点其中一方已经空了，没了，那就不需要进行下面第四步的乱序比较了，直接进行插入和删除即可</p></li> <li><p><strong>如果不是上述的简单情况，那么就需要进行复杂比对了</strong></p> <p>继续回到统一案例中，当经过一二轮筛选后，而且发现新老节点都还有剩下，那么就不会走第三步。接下来，就需要进行复杂的乱序比较了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 经过第一二轮的筛选，剩下的为</span>
<span class="token literal-property property">c1</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 老节点</span>
<span class="token literal-property property">c2</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
  <span class="token comment">// 新节点</span>
  <span class="token comment">// 其中，c1代表老节点List, c2代表新节点list</span>

  <span class="token comment">// 还有几个变量要注意，s1, e1, s2, e2，分别对应老节点的开始，老节点的结束，新节点的开始，新节点的结束对应的数组下标index</span>
  s1
<span class="token punctuation">)</span><span class="token punctuation">(</span>e1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">c1</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 老节点</span>
<span class="token literal-property property">c2</span><span class="token operator">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
  <span class="token comment">// 新节点</span>
  s2
<span class="token punctuation">)</span><span class="token punctuation">(</span>e2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// s1 = 2, e1 = 4</span>
<span class="token comment">// s2 = 2, e2 = 5</span>
</code></pre></div><ul><li><p>4.1 第一步，先创建一个 c2 中新节点的 map 映射表</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> keyToNewIndexMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 从s2到e2，创建映射表</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> s2<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 键为子元素的key，值为子元素的c2数组下标</span>
  keyToNewIndexMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// keyToNewIndexMap</span>
<span class="token comment">// [e:2, c:3, d:4, h:5]</span>
</code></pre></div></li> <li><p>4.2 第二步，循环老元素 c1，看新的里面有没有，如果有，比较差异并添加，如果没有，就删掉老元素</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
</code></pre></div></li></ul></li></ol> <h3 id="最长递增子序列"><a href="#最长递增子序列" class="header-anchor">#</a> 最长递增子序列</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/leo-blog/computer-science/Front-end/Node.html" class="prev">
        Node
      </a></span> <span class="next"><a href="/leo-blog/computer-science/Front-end/React.html">
        React
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/leo-blog/assets/js/app.bfe0a0b7.js" defer></script><script src="/leo-blog/assets/js/2.36229468.js" defer></script><script src="/leo-blog/assets/js/23.666f621b.js" defer></script>
  </body>
</html>
